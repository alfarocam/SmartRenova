<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head th:replace="~{layout/plantilla :: head}">
  <style>
    :root{
      --sr-green:#7a8f3a;      /* ajusta al verde de tu marca */
      --sr-green-2:#a7ba55;
      --sr-muted:#6c757d;
      --sr-border:#e8ecef;
    }
    .sr-title{font-weight:900; letter-spacing:.2px}
    .sr-sub{color:var(--sr-muted)}
    .sr-card{background:#fff;border:1px solid var(--sr-border);border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.06)}
    .sr-items thead th{border-bottom:2px solid var(--sr-border); color:#2f3842; font-weight:700}
    .sr-items td,.sr-items th{padding:16px 18px; vertical-align:middle}
    .sr-items tbody tr+tr td{border-top:1px solid var(--sr-border)}
    .right{text-align:right}
    .sr-name{font-weight:700}
    .sr-desc{color:var(--sr-muted); font-size:.9rem}
    .sr-qty{display:flex; justify-content:flex-end; align-items:center; gap:.4rem}
    .sr-qty .btn{min-width:36px; height:36px; line-height:1; border-radius:10px}
    .sr-qty input[type="number"]{width:90px; text-align:center}
    .sr-trash{border-color:#e9b1b1; color:#c84343}
    .sr-trash:hover{background:#c84343; color:#fff}
    .sr-summary{position:sticky; top:88px}
    .sr-total-row{display:flex; justify-content:space-between; align-items:center; padding:18px}
    .sr-total-label{font-weight:700}
    .sr-total-val{font-weight:900; font-size:1.2rem}
    .sr-pay{background:var(--sr-green); color:#fff; border:none; width:100%; padding:16px; border-radius:12px; font-weight:800}
    .sr-pay:disabled{opacity:.6; cursor:not-allowed}
    .sr-back{border-radius:12px}
    @media (max-width: 768px){
      .sr-items thead{display:none}
      .sr-items tbody tr{display:grid; grid-template-columns:1fr 1fr; row-gap:.25rem; padding:10px 0}
      .sr-items td[data-th]::before{content:attr(data-th); display:block; color:var(--sr-muted); font-size:.8rem}
      .right{text-align:left}
      .sr-qty{justify-content:flex-start}
    }
  </style>
</head>
<body>
<header th:replace="~{layout/plantilla :: header}"></header>

<main class="container my-4">
  <div class="row g-4">
    <!-- Col izquierda: lista de items -->
    <div class="col-lg-8">
      <h1 class="display-6 sr-title mb-1">Carrito de compras</h1>
      <div class="sr-sub mb-3" th:text="${carritoCount} + ' art√≠culo(s)'">0 art√≠culo(s)</div>

      <div class="sr-card p-2 p-md-3">
        <!-- estado vac√≠o -->
        <div th:if="${#lists.isEmpty(listaItems)}" class="p-4 text-center">
          <div class="mb-2">üß∫</div>
          <p class="mb-3">Tu carrito est√° vac√≠o.</p>
          <a class="btn btn-outline-secondary sr-back" th:href="@{/catalogo}">‚Üê Volver al cat√°logo</a>
        </div>

        <!-- tabla -->
        <div th:if="${!#lists.isEmpty(listaItems)}" class="table-responsive">
          <table class="table sr-items mb-0">
            <thead>
              <tr>
                <th>Producto</th>
                <th class="right">Precio</th>
                <th class="right">Cantidad</th>
                <th class="right">Total</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="i : ${listaItems}">
                <td data-th="Producto">
                  <div class="sr-name" th:text="${i.descripcion}">Producto</div>
                  <div class="sr-desc" th:if="${i.detalle != null}" th:text="${i.detalle}"></div>
                </td>
                <td class="right" data-th="Precio">
                  ‚Ç°<span th:text="${#numbers.formatDecimal(i.precio,0,'POINT',0,'COMMA')}">0</span>
                </td>
                <td class="right" data-th="Cantidad">
                  <div class="sr-qty">
                    <!-- -1 -->
                    <form th:action="@{/carrito/guardar}" method="post" class="d-inline">
                      <input type="hidden" name="idProducto" th:value="${i.idProducto}"/>
                      <input type="hidden" name="cantidad" th:value="${i.cantidad - 1}"/>
                      <button class="btn btn-outline-secondary btn-sm" th:disabled="${i.cantidad <= 1}">‚àí</button>
                    </form>
                    <!-- input -->
                    <form th:action="@{/carrito/guardar}" method="post" class="d-inline">
                      <input type="hidden" name="idProducto" th:value="${i.idProducto}"/>
                      <input class="form-control form-control-sm" type="number" min="1" name="cantidad"
                             th:value="${i.cantidad}" oninput="this.form.requestSubmit()"/>
                    </form>
                    <!-- +1 -->
                    <form th:action="@{/carrito/guardar}" method="post" class="d-inline">
                      <input type="hidden" name="idProducto" th:value="${i.idProducto}"/>
                      <input type="hidden" name="cantidad" th:value="${i.cantidad + 1}"/>
                      <button class="btn btn-outline-secondary btn-sm">+</button>
                    </form>
                    <!-- eliminar -->
                    <a class="btn btn-outline-danger btn-sm sr-trash"
                       th:href="@{'/carrito/eliminar/' + ${i.idProducto}}"
                       title="Quitar" onclick="return confirm('¬øEliminar este producto?')">
                      <i class="fa fa-trash"></i>
                    </a>
                  </div>
                </td>
                <td class="right" data-th="Total">
                  ‚Ç°<span th:text="${#numbers.formatDecimal(i.cantidad * i.precio,0,'POINT',0,'COMMA')}">0</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="mt-3">
        <a class="btn btn-outline-secondary sr-back" th:href="@{/catalogo}">‚Üê Volver al cat√°logo</a>
      </div>
    </div>

    <!-- Col derecha: resumen -->
    <div class="col-lg-4">
      <div class="sr-card p-3 sr-summary">
        <div class="sr-total-row">
          <div class="sr-total-label">Total a cancelar</div>
          <div class="sr-total-val">
            ‚Ç°<span th:text="${#numbers.formatDecimal(carritoTotal,0,'POINT',0,'COMMA')}">0</span>
          </div>
        </div>
        <form th:action="@{/carrito/facturar}" method="post" class="p-2 pt-0">
          <button type="submit" class="btn-pay" th:disabled="${#lists.isEmpty(listaItems)}">
            Pagar
          </button>
        </form>
        <div class="text-center mt-2">
          <small class="sr-sub">Impuestos inclu√≠dos donde aplique</small>
        </div>
      </div>
    </div>
  </div>
</main>

<footer th:replace="~{layout/plantilla :: footer}"></footer>
</body>
</html>
